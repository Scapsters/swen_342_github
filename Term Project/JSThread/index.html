<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Thread Intro</title>
		<script src="./src/index.ts" type="module"></script>
		<link rel="stylesheet" type="text/css" href="index.css" />

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet" />
		<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet" />
	</head>

	<body class="overflow-x-hidden text-slate-800">
		<h1 class="p-8 text-4xl font-bold text-center gradient text-white/85 w-1/1">
			Threads in
			<span class="underline text-sky-600/85 underline-offset-9">Typescript</span>
		</h1>
		<div class="flex flex-col items-center h-screen pt-6 z-1 bg-zinc-50">
			<div
				class="m-4 duration-300 border-l-2 max-h-15 w-9/10 hover:bg-neutral-200 has-checked:bg-neutral-200 has-checked:border-sky-700 has-checked:border-l-6 has-checked:max-h-1/1"
			>
				<input type="checkbox" id="overview" class="hidden peer" />
				<label for="overview" class="block p-2 font-bold duration-300 select-none hover:bg-neutral-300">
					Design Overview
				</label>
				<div class="h-0 ml-2 overflow-hidden duration-300 l-2 peer-checked:max-h-auto peer-checked:h-1/1">
					<p>
						A "Thread" is a stack being executed on a single processor. It's a list of instructions and
						nothing more.
					</p>
					<br />
					<p>Javascript only has one thread. A single javascript file will never use more than one CPU.</p>
					<br />
					<p>
						Javascript has Promises. They are the promise of a value, and can be waited on, can have
						callbacks attached to their resolution, or passed around arbitrarily.
					</p>
					<p>
						Javascript also has Web-Workers. The constructor's signature is essentially
						<code>new Worker(filename: string)</code>. This creates a new javascript program running in an
						entirely different chunk of memory. Workers have built-in ways to communicate with the main
						thread. The implementation of communication is unknown, but is probably an internal
						server/client communication.
					</p>
					<br />
					<p>
						Through the usage of these two concepts, Javascript can have threads. My goal is to implement as
						many features from <code>Java.Thread</code> as possible.
					</p>
					<p>
						The basic principle is that threads can communicate with many types of values, but strings are
						the safest. For example, many functions cannot be passed since they contain closures, which
						would be a violation of memory. Luckily, strings can represent basically anything. We can tell
						workers to start, wait, etc., and threads can wait, notify, end, etc.
					</p>
					<p>
						It's not hard to see how, through the usage of async programming and worker communication, we
						can create a reasonable implementation of Java's Threads.
					</p>
					<p>An additional goal is to make it as similar as possible to using the same features in Java.</p>
				</div>
			</div>
			<div
				class="m-4 duration-300 border-l-2 max-h-15 w-9/10 hover:bg-neutral-200 has-checked:bg-neutral-200 has-checked:border-sky-700 has-checked:border-l-6 has-checked:max-h-1/1"
			>
				<input type="checkbox" id="documentation" class="hidden peer" />
				<label for="documentation" class="block p-2 font-bold duration-300 select-none hover:bg-neutral-300"> Documentation </label>
				<div class="h-0 ml-2 overflow-hidden duration-300 l-2 peer-checked:max-h-auto peer-checked:h-1/1">
					<p>
						The text area below is fed into the program using the Function constructor, so it has access to
						any default javascript function.
					</p>
					<br />
					<p>
						Additionally, the classes Thread and Log are fed into the function, meaning you can use the
						following methods:
					</p>
					<ul class="list-disc list-outside [&_ul]:list-[revert] pl-5 mt-0">
						<li class="p-2">
							<span class="code"
								>New Thread(worker_filename: string, initial_data: { [key: string]: string }, log_name:
								string)</span
							>
							<p>
								Creates a new thread with the given filename and initial data.
								<span class="code">log_name</span> is optional, and defaults to "Thread".
							</p>
						</li>
						<ul class="pl-5 list-outside ps-5">
							<li class="p-2">
								<span class="code">worker_filename: string</span>
								<p>
									Filename that the worker will start with. Because workers cannot share memory, the
									file must not use members of any files in the main thread.
								</p>
							</li>
							<li class="p-2">
								<span class="code">initial_data: { [key: string]: string }</span>
								<p>
									This object will be sent to the worker upon instantiation. Any updates that the
									worker makes to this data will be reflected in the Thread object. The Thread object
									will not modify this data, only the worker. Can be <span class="code">{}</span> to
									pass no data.
								</p>
							</li>
							<li class="p-2">
								<span class="code">log_name: string</span>
								<p>This is the name that will be used when logging messages.</p>
							</li>
						</ul>

						<li class="p-2">
							<span class="code">Thread.start()</span>
							<p>
								Starts a thread in the same way Java's <span class="code">Thread.start()</span> would.
							</p>
						</li>
						<li class="p-2">
							<span class="code">Thread.join() </span>
							<p>
								Pauses the main thread in a similar way to how Java's
								<span class="code">Thread.join()</span> would. Because this is javascript, the actual
								return value is <span class="code">Promise&lt;void&gt;</span>, so we must use
								<span class="code">await</span> before the promise. This will pause the main thread
								until the awaited worker finishes. An example of this is
								<span class="code">await new Thread('WorkerThread', {}).start()</span>.
							</p>
						</li>
						<li class="p-2"><span class="code">Log.log(message: string)</span></li>
					</ul>
				</div>
			</div>
			<div class="flex flex-col items-stretch w-9/10">
				<textarea
					id="code"
					spellcheck="false"
					class="p-3 font-mono! rounded-lg bg-neutral-900 text-white h-80 overflow-auto"
				>
new Thread('WorkerThread', {}).start()
Log.log('Hello World!')
				</textarea
				>
				<button
					id="start"
					class="p-1 m-1 duration-150 border-4 bg-slate-100 rounded-xl w-15 border-slate-500 hover:border-teal-500 hover:bg-slate-200 active:bg-white"
				>
					Run
				</button>
				<div id="console" class="m-4 bg-gray-900 rounded-lg text-slate-200 h-80 border-t-slate-600 border-t-36">
					<p class="p-3 -mt-10 text-slate-200">Console</p>
					<div id="output" class="pl-4 -mt-2 overflow-auto text-slate-200 h-1/1"></div>
				</div>
			</div>
		</div>
	</body>
</html>
