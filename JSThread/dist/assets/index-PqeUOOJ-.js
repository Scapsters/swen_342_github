(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function l(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=l(e);fetch(e.href,o)}})();const g=class g{constructor(t){this.name=t,this.log_color=`oklch(80% .23 ${this.color_hash(t)%12*30})`}static log(t,l=""){t=t.split(/\s+/).map(c=>{const e=this.colors[this.special_words[c.toLocaleLowerCase()]]||"white";return this.wrap_color(e,c)}).join(" "),document.getElementById("output").innerHTML+=l+t+"<br>"}log(t){g.log(t,`<span style="color:${this.log_color};">${this.name}</span>: `)}static wrap_color(t,l){return`<span style="color:${t};">${l}</span>`}color_hash(t){return t.split("").reduce((l,c)=>l+c.charCodeAt(0),2)}};g.special_words={request:"blue",requesting:"blue",release:"yellow",releasing:"yellow",wait:"purple",waiting:"purple",notify:"orange",notifying:"orange",notifyAll:"red",notifyingAll:"red",acquired:"green",acquiring:"green"},g.colors={blue:"oklch(80% .23 240)",yellow:"oklch(80% .23 60)",purple:"oklch(80% .23 300)",orange:"oklch(80% .23 30)",red:"oklch(80% .23 0)",green:"oklch(80% .23 120)"};let d=g;const u="data:video/mp2t;base64,aW1wb3J0IFRocmVhZCwgeyBpbml0VGhyZWFkIH0gZnJvbSAiLi9Xb3JrZXJUaHJlYWQiOw0KDQpjbGFzcyBDb3VudGVyV29ya2VyIGV4dGVuZHMgVGhyZWFkIHsNCiAgICAvLyBFbXB0eSBmb3Igbm93LiBUaHJlYWQgaXMgcXVpdGUgZXh0ZW5zaWJsZSBzbyB0aGlzIHNob3VsZCBiZSBhIHNtYWxsIGNsYXNzIGNvbXBhcmVkIHRvIGl0Lg0KfQ0KDQppbml0VGhyZWFkKCk=",m="data:video/mp2t;base64,ZXhwb3J0IGNsYXNzIFRocmVhZCB7DQoJc3RhdGljIHJlYWRvbmx5IGRhdGE6IERpY3QgPSB7fTsNCg0KCS8qKg0KCSAqIFRoZSBtYWluIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBydW4gYnkgdGhlIHdvcmtlci4NCgkgKiBTaG91bGQgY2FsbCBgaW5pdERhdGFgIGFuZCBgZW5kYA0KCSAqIEBwYXJhbSBkYXRhIC0gVGhlIGRhdGEgcGFzc2VkIHRvIHRoZSB3b3JrZXIgZnJvbSB0aGUgbWFpbiB0aHJlYWQNCgkgKi8NCglzdGF0aWMgYXN5bmMgcnVuKGRhdGE6IERpY3QpIHsNCgkJVGhyZWFkLmluaXREYXRhKGRhdGEpOw0KCQlhd2FpdCBUaHJlYWQuc3luY2hyb25pemVkKGFzeW5jICgpID0+IHsNCgkJCVRocmVhZC5wcmludCgiQWNxdWlyZWQgS2V5Iik7DQoJCQlhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSkgPT4gc2V0VGltZW91dCgoKSA9PiByZXNvbHZlKCksIDEwMDApKTsNCgkJfSk7DQoJCVRocmVhZC5lbmQoKTsNCgl9DQoNCgkvKioNCgkgKiBSZXR1cm5zIGEgcHJvbWlzZSBvZiB0aGUgZXhlY3V0aW9uIG9mIGFuIGFyYml0cmFyeSBmdW5jdGlvbi4NCgkgKiBFeGVjdXRpb24gY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBrZXkgaXMgbm90IGluIHVzZSBieSBhbnkgb3RoZXIgd29ya2VyLg0KCSAqIE90aGVyd2lzZSwgaXQgd2lsbCBiZSBxdWV1ZWQgZm9yIGV4ZWN1dGlvbg0KCSAqIEBwYXJhbSBjYWxsYmFjayAtIFRoZSBmdW5jdGlvbiB0byBiZSBleGVjdXRlZA0KCSAqIEByZXR1cm5zIFByb21pc2U8dm9pZD4gQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgZnVuY3Rpb24gaXMgZXhlY3V0ZWQNCgkgKi8NCglzdGF0aWMgYXN5bmMgc3luY2hyb25pemVkKGNhbGxiYWNrOiAoKSA9PiBQcm9taXNlPHZvaWQ+KTogUHJvbWlzZTx2b2lkPiB7DQoJCS8vIFJlcXVlc3QgYW5kIHdhaXQgZm9yIHRoZSBrZXkNCgkJVGhyZWFkLnJlcXVlc3QoImtleTEiKTsNCgkJYXdhaXQgbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUpID0+IHsNCgkJCXNlbGYub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7DQoJCQkJY29uc3QgW2FjdGlvbiwgdmFsdWVdID0gW2V2ZW50LmRhdGEuYWN0aW9uLCBldmVudC5kYXRhLnZhbHVlXTsNCg0KCQkJCS8vIENhdGNoIGFueSBtZXNzYWdlcyB0aGF0IGdpdmUgdXMgdGhlIGtleQ0KCQkJCWlmIChhY3Rpb24gPT09ICJnaXZlIiAmJiB2YWx1ZSA9PT0gImtleTEiKSByZXNvbHZlKCk7DQoNCgkJCQkvLyBGYWxsIHRocm91Z2ggdG8gZGVmYXVsdA0KCQkJCW9ubWVzc2FnZShldmVudCk7DQoJCQl9Ow0KCQl9KTsNCg0KCQkvLyBFeGVjdXRlLCByZWxlYXNlLCBhbmQgcmVzb2x2ZQ0KCQlhd2FpdCBjYWxsYmFjaygpOw0KCQlUaHJlYWQucmVsZWFzZSgia2V5MSIpOw0KCX0NCg0KCS8qKg0KCSAqIEFjdHMgYXMgYSBwcm94eSwgYWxsb3dpbmcgdGhlIG1haW4gdGhyZWFkIHRvIGtlZXAgdHJhY2sgb2YgYWxsIHN0YXRlIGNoYW5nZXMNCgkgKiBAcGFyYW0gcHJvcGVydHkgLSBUaGUgcHJvcGVydHkgdG8gYmUgc2V0DQoJICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIGJlIHNldA0KCSAqLw0KCXN0YXRpYyBzZXREYXRhKHByb3BlcnR5OiBzdHJpbmcsIHZhbHVlOiBhbnkpIHsNCgkJVGhyZWFkLmRhdGFbcHJvcGVydHldID0gdmFsdWU7DQoJCVRocmVhZC5wcmludChgU2V0ICR7cHJvcGVydHl9IHRvICR7dmFsdWV9YCk7DQoJfQ0KDQoJLyoqDQoJICogSW5pdGlhbGl6ZXMgdGhlIGRhdGEgaW4gdGhlIHdvcmtlcg0KCSAqIEBwYXJhbSBkYXRhIC0gVGhlIGRhdGEgdG8gYmUgc2V0DQoJICovDQoJcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgaW5pdERhdGEgPSAoZGF0YTogRGljdCkgPT4gew0KCQlmb3IgKGNvbnN0IFtwcm9wZXJ0eSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSBUaHJlYWQuc2V0RGF0YShwcm9wZXJ0eSwgdmFsdWUpOw0KCX07DQoNCgkvKg0KCSAqIEhlbHBlciBmdW5jdGlvbnMNCgkgKi8NCglwcm90ZWN0ZWQgc3RhdGljIHByaW50KG1lc3NhZ2U6IHN0cmluZyk6IFRocmVhZCB7DQoJCXNlbGYucG9zdE1lc3NhZ2UoeyBhY3Rpb246ICJwcmludCIsIHZhbHVlOiBtZXNzYWdlIH0pOw0KCQlyZXR1cm4gVGhyZWFkOw0KCX0NCglwcm90ZWN0ZWQgc3RhdGljIGVuZCgpOiBUaHJlYWQgew0KCQlzZWxmLnBvc3RNZXNzYWdlKHsgYWN0aW9uOiAiZW5kIiB9KTsNCgkJcmV0dXJuIFRocmVhZDsNCgl9DQoJcHJvdGVjdGVkIHN0YXRpYyByZXF1ZXN0KGtleTogc3RyaW5nKTogVGhyZWFkIHsNCgkJc2VsZi5wb3N0TWVzc2FnZSh7IGFjdGlvbjogInJlcXVlc3QiLCB2YWx1ZToga2V5IH0pOw0KCQlyZXR1cm4gVGhyZWFkOw0KCX0NCglwcm90ZWN0ZWQgc3RhdGljIHJlbGVhc2Uoa2V5OiBzdHJpbmcpOiBUaHJlYWQgew0KCQlzZWxmLnBvc3RNZXNzYWdlKHsgYWN0aW9uOiAicmVsZWFzZSIsIHZhbHVlOiBrZXkgfSk7DQoJCXJldHVybiBUaHJlYWQ7DQoJfQ0KfQ0KDQovKioNCiAqIERlZmF1bHQgbWVzc2FnZSBoYW5kbGVyLiBDYW4gYmUgZGVjb3JhdGVkIGJ5IG90aGVyIG1ldGhvZHMuDQogKiBAcGFyYW0gZXZlbnQgLSBNZXNzYWdlIGZyb20gdGhlIG1haW4gdGhyZWFkDQogKi8NCmNvbnN0IG9ubWVzc2FnZSA9IChldmVudDogTWVzc2FnZUV2ZW50KSA9PiB7DQoJY29uc3QgcGF5bG9hZDogUGF5bG9hZCA9IGV2ZW50LmRhdGE7DQoJaWYgKHBheWxvYWQuYWN0aW9uID09PSAic3RhcnQiKSBUaHJlYWQucnVuKHBheWxvYWQuZGF0YSk7DQp9Ow0KDQovKioNCiAqIEluaXRpYWxpemVzIHRoZSB3b3JrZXIuIE5lZWRzIHRvIGJlIGNhbGxlZCBvbmNlIHBlciB3b3JrZXIuIEltcG9ydGluZyBXb3JrZXJUaHJlYWQgd2lsbCBkby4NCiAqLw0KZXhwb3J0IGZ1bmN0aW9uIGluaXRUaHJlYWQoKSB7DQoJc2VsZi5vbm1lc3NhZ2UgPSBvbm1lc3NhZ2U7DQp9DQoNCmluaXRUaHJlYWQoKTsNCg0KZXhwb3J0IGRlZmF1bHQgVGhyZWFkOw0K";class r{constructor(){this.queue=[]}enqueue(t){this.queue.push(t)}dequeue(){return this.queue.shift()}isEmpty(){return this.queue.length===0}peek(){return this.queue[0]}}const s=class s{constructor(t,l,c="Thread"){this.data={};const e=new URL(Object.assign({"./Workers/CounterThread.ts":u,"./Workers/WorkerThread.ts":m})[`./Workers/${t}.ts`],import.meta.url);this.worker=new Worker(e.href,{type:"module"}),this.worker.onerror=o=>console.error("Worker error",o),this.worker.onmessage=this.onmessage.bind(this),this.data=l,this.log=new d(c)}start(){return this.worker.postMessage({action:"start",data:this.data}),this}join(){return new Promise(t=>{this.worker.onmessage=l=>{l.data.action==="end"&&t(),this.onmessage(l)}})}onmessage(t){const l=t.data,[c,e]=[l.action,l.value];switch(c){case"print":this.log.log(e);break;case"request":this.log.log(`Requesting ${e}`),this.addKey(e),s.keys[e].isEmpty()?(s.keys[e].enqueue(this.worker),this.give(e)):s.keys[e].enqueue(this.worker);break;case"release":this.log.log(`Releasing ${e}`),this.addKey(e),s.keys[e].dequeue(),this.giveTo(e,s.keys[e].peek());break;case"wait":this.addWait(e),s.waits[e].enqueue(this.worker);break;case"notify":this.addWait(e),this.notifyTo(e,s.waits[e].dequeue());break;case"notifyAll":{const o=s.waits[e];for(;!o.isEmpty();)this.notifyTo(e,o.dequeue());break}}}addKey(t){return s.keys[t]?!1:(s.keys[t]=new r,!0)}addWait(t){return s.waits[t]?!1:(s.waits[t]=new r,!0)}give(t){this.worker.postMessage({action:"give",value:t})}giveTo(t,l){l==null||l.postMessage({action:"give",value:t})}notifyTo(t,l){l==null||l.postMessage({action:"notify",value:t})}};s.keys={},s.waits={};let n=s;const Z=Object.getPrototypeOf(async function(){}).constructor;async function G(){const i=document.getElementById("code").value;new Z("Thread","Log",i)(n,d)}function I(){document.getElementById("output").innerHTML=""}function W(){document.getElementById("code").value=""}function h(i){document.getElementById("code").value=b[i]}function C(){const i=window.scrollY;console.log(document.documentElement),console.log(document.documentElement.style),document.documentElement.style.setProperty("--y-scroll",i.toString()+"px")}document.addEventListener("scroll",C);document.getElementById("start").addEventListener("click",G);document.getElementById("clearConsole").addEventListener("click",I);document.getElementById("clearCode").addEventListener("click",W);document.getElementById("Log Example").addEventListener("click",i=>h(0));document.getElementById("Sync+Join Example").addEventListener("click",i=>h(1));const b=['Log.log("Hello, world!");',`const threads = [];
for(let i = 0; i < 4; i++) {
	threads.push(new Thread('WorkerThread', {}, \`Thread\${i+1}\`));
}

const [t1, t2, t3, t4] = threads;

await t1.start().join() // Main thread will stop here
t2.start() // All 3 threads will start at once, but only one will have the key at a time.
t3.start()
t4.start()`];
